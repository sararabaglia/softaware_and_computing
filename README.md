# Cutflows

These scripts can be used to print out the Cutflows generated by the [SusySkimMaker](https://gitlab.cern.ch/SusySkimAna/SusySkimMaker) Analysis Package.

# Cutflows from histograms

## From config file

Formatted cut flow tables can be generated using the script
printCutflow.py. It takes a python config file as an argument.
Type -h for more options.

The most simple example is given by `config.py`:

```python
config = {
    "processes" : [("ttbar 410000", "ttbar_410000.txt"),],
    "format" : "csv",
    "outputdir" : "csv",
}
```

This will create a cutflow only for ttbar DatasetNumber 410000 where
the root files containing the cutflow tables are listed in the given
txt file. To create the txt file you can do e.g.

```sh
ls user.*410000*tree.root/*.root* > ttbar_410000.txt
```

Where `user.*410000*tree.root` are the unmerged tree (or skim) files that you downloaded from the grid.

To finally create the cutflows just run:

```sh
./printCutflow.py config.py
```

See `-h` for more options.

`config_bkg.py` is a more complete example for creating a cutflow with multiple columns.

## From command line

If you simply want to print cutflows for list of rootfiles (and don't
need a complicated configuration for multiple processes etc.) you can
just give a list of root files via the command line option `-i`:

```sh
./printCutflow.py -i user.*410000*tree.root/*.root*
```

## Rescale cutflows

To normalize the cutflows to cross section use the command line option `--rescale-cutflows` or the option in the config file - e.g:

```python
    "rescale_by" : lambda sumw, xsec : xsec/sumw*36065.96,
```

In order for this to work, the input files have to contain the
*unmerged* trees.  If used via the command line `xsec*lumi/sumw` is
used where the lumi is given via `--lumi`. The DatasetNumber and cross
section will be fetched from the *unmerged* trees in the rootfiles. If
they are empty the script tries to parse the dsid from the input file
path. In this case you have to specify a path to the cross section
files (e.g. from SUSYTools) via the option `--xsec-dir` (or `xsec_dir`
in the config file).

The `sumw` is fetched either from the `weighted__AOD` histogram or the `CutBookkeepers` tree.


## Caveats

Be careful about the following:

* Don't merge processes where you would apply further cuts which where
  possibly not applied yet during the creation of the cutflows
  (e.g. generator level filter cuts like for the met/ht filtered ttbar
  samples)
* If you have samples that need a more complicated normalisation
  scheme as per-dsid (e.g. per SUSY final state) the rescale function
  won't work properly

# Cutflows from trees

Cutflows can also be created from flat TTrees using TTree::Draw. An example config file is given by `config_tree.py`.

